/*
 * JSP generated by Resin-3.0.28 (built Mon, 18 May 2009 02:16:38 PDT)
 */

package _jsp._web_22dinf._vistas;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import com.siagcee.logic.*;
import java.util.*;
import java.text.DecimalFormat;

public class _userobjetos__jsp extends com.caucho.jsp.JavaPage{
  private boolean _caucho_isDead;
  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.Application _jsp_application = _caucho_getApplication();
    javax.servlet.ServletContext application = _jsp_application;
    com.caucho.jsp.PageContextImpl pageContext = com.caucho.jsp.QJspFactory.allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    response.setContentType("text/html;charset=UTF-8");
    request.setCharacterEncoding("UTF-8");
    try {
      out.write(_jsp_string0, 0, _jsp_string0.length);
      
HttpSession sesion = request.getSession();
Encuestado encuestado = (Encuestado)sesion.getAttribute("usuario");
if(encuestado == null){

      out.write(_jsp_string1, 0, _jsp_string1.length);
      pageContext.forward("autenticarusuario.do");
      if (true) return;
      out.write('\n');
      
}

      out.write(_jsp_string2, 0, _jsp_string2.length);
      

String mensaje = "";
if(request.getAttribute("mensaje") != null){
	mensaje = (String)request.getAttribute("mensaje");
	request.setAttribute("mensaje", "");
}

Vector _objetos = (Vector)request.getAttribute("objetos");

InstanciaObjeto _miIns = null;
Vector _misRespDadas = new Vector();
if(request.getAttribute("seleccionado") != null){
	_miIns = (InstanciaObjeto)request.getAttribute("seleccionado");
	if(request.getAttribute("respuestasDadas") != null){
		_misRespDadas = (Vector)request.getAttribute("respuestasDadas");
	}
}


      out.write(_jsp_string3, 0, _jsp_string3.length);
      
if (!mensaje.equals("")) {
	out.println(mensaje + "<p />");
}
if(_miIns == null){

      out.write(_jsp_string4, 0, _jsp_string4.length);
      
}else{
	StringBuffer _pregTit = new StringBuffer();  //preguntas titulares inicio de pagina
	StringBuffer _pregResp = new StringBuffer(); //preguntas a responder parte final de la pagina
	//lanzo el conjunto de preguntas
	out.print("<h4><a name='top'>"+_miIns.getObjeto()+"</a></h4>");
	
      out.write(_jsp_string5, 0, _jsp_string5.length);
       out.print(_miIns.getId());
      out.write(_jsp_string6, 0, _jsp_string6.length);
      
	try{
		Vector _temporalPreguntas = _miIns.getObjetoAsociado().getPreguntas(true);
		Collections.sort(_temporalPreguntas, new OrdenadorInstanciaPreguntas());  //ordenado por ordenPregunta
		Collections.sort(_misRespDadas, new OrdenadorRespuestas());     //ordenado por ordenPregunta
		Enumeration _misPreg = _temporalPreguntas.elements();
		InstanciaPregunta miPreg;
		Enumeration _misRespDadasTmp = _misRespDadas.elements();
		Respuesta miRespDada = new Respuesta();
		boolean respEncontrada = false;

		while(_misPreg.hasMoreElements()){
			//para verificar si se encontro una respuesta guardada previamente

			respEncontrada = false;

			miPreg = (InstanciaPregunta)_misPreg.nextElement();

			//es interna para calculos de estudios.
			if(miPreg.getTipoPregunta() == 100){
				continue;
			}
			//titulo de la pregunta
			_pregTit.append("<a href='#pregunta_"+miPreg.getId()+"'>"+miPreg.getTextoPregunta()+"</a><p />");

			//muestro la pregunta
			_pregResp.append("<p><a name='pregunta_"+miPreg.getId()+"'><label>"+miPreg.getTextoPregunta()+"</label></a>&nbsp;&nbsp;&nbsp;&nbsp;<a href='#top' title='Regresar al tope de la p&aacute;gina'><img src='comunes/imagenes/top.png' height='18'></a><br />");


			//+++++++++++++++
			//seleccion simple
			//+++++++++++++++
			if(miPreg.getTipoPregunta() == 1){

				//ubico la respuesta correspondiente a la pregunta, si existiera
				while(_misRespDadasTmp.hasMoreElements()){
					miRespDada = (Respuesta)_misRespDadasTmp.nextElement();
					if(miPreg.getId() == miRespDada.getInstanciaPregunta().getId()){
						respEncontrada = true;
						break;
					}
				}

				if(miPreg.isCampo_clave_unico()){
					_pregResp.append("<select id='pregunta_"+miPreg.getId()+"' name='pregunta_"+miPreg.getId()+"' disabled='disabled'>");
				}else{
					_pregResp.append("<select id='pregunta_"+miPreg.getId()+"' name='pregunta_"+miPreg.getId()+"'>");
				}
				if(!respEncontrada || miRespDada.getRespuestaCerrada().getId() < 0){
					//si no encontr\u00c3\u00a9 respuesta este option va
					_pregResp.append("<option value='-1' selected='selected'>Seleccione...</option>");
				}else{
					//si encontr\u00c3\u00a9 respuesta este option va
					_pregResp.append("<option value='-1'>No s&eacute;/No respondo</option>");
				}

				try{
					Enumeration _misResp = miPreg.getPreguntaAsociada().retornaRespuestasPosibles(true).elements();
					RespuestasPosibles __misResp;
					while(_misResp.hasMoreElements()){
						__misResp = (RespuestasPosibles)_misResp.nextElement();
						if(respEncontrada && (miRespDada.getRespuestaCerrada().getId() == __misResp.getId())){
							_pregResp.append("<option value='"+__misResp.getId()+"' selected='selected'>"+__misResp.getRespuesta()+"</option>");
							respEncontrada = false;
							miRespDada = new Respuesta();
						}else{
							_pregResp.append("<option value='"+__misResp.getId()+"'>"+__misResp.getRespuesta()+"</option>");
						}
					}
				}catch(Exception e){e.printStackTrace();
				}finally{
					_pregResp.append("</select>");
				}

			//+++++++++++++++
			//seleccion m\u00c3\u00baltiple
			//+++++++++++++++
			}else if(miPreg.getTipoPregunta() == 2){
				Vector _temporalRespuestas = new Vector();
				//ubico la respuesta correspondiente a la pregunta, si existiera
				while(_misRespDadasTmp.hasMoreElements()){
					miRespDada = (Respuesta)_misRespDadasTmp.nextElement();
					if(miPreg.getId() == miRespDada.getInstanciaPregunta().getId()){
						respEncontrada = true;
						//ubico las respuestas en un vector de menor tama\u00c3\u00b1o temporal para recorrer en el momento de identificar las respuestas
						_temporalRespuestas.add(miRespDada);
					}
				}

				if(miPreg.isCampo_clave_unico()){
					_pregResp.append("<select id='pregunta_"+miPreg.getId()+"' name='pregunta_"+miPreg.getId()+"' multiple disabled='disabled'>");
				}else{
					_pregResp.append("<select id='pregunta_"+miPreg.getId()+"' name='pregunta_"+miPreg.getId()+"' multiple>");
				}
				if(!respEncontrada || miRespDada.getRespuestaCerrada().getId() < 0){
					//si no encontr\u00c3\u00a9 respuesta este option va
					_pregResp.append("<option value='-1' selected='selected'>Seleccione...</option>");
				}else{
					//si encontr\u00c3\u00a9 respuesta este option va
					_pregResp.append("<option value='-1'>No s&eacute;/No respondo</option>");
				}

				try{
					Enumeration _misResp = miPreg.getPreguntaAsociada().retornaRespuestasPosibles(true).elements();
					RespuestasPosibles __misResp;
					while(_misResp.hasMoreElements()){
						__misResp = (RespuestasPosibles)_misResp.nextElement();

						boolean _miEncontrado = false;
						Enumeration _temporalResp = _temporalRespuestas.elements();
						Respuesta _miTemporalRespuestas;
						while(_temporalResp.hasMoreElements()){
							_miTemporalRespuestas = (Respuesta)_temporalResp.nextElement();
							if(__misResp.getId() == _miTemporalRespuestas.getRespuestaCerrada().getId()){
								_miEncontrado = true;
							}
						}
						if(_miEncontrado){
							_pregResp.append("<option value='"+__misResp.getId()+"' selected='selected'>"+__misResp.getRespuesta()+"</option>");
						}else{
							_pregResp.append("<option value='"+__misResp.getId()+"'>"+__misResp.getRespuesta()+"</option>");
						}
					}
				}catch(Exception e){e.printStackTrace();
				}finally{
					_pregResp.append("</select>");
				}

			//+++++++++++++++
			//preguntas abiertas
			//+++++++++++++++
			}else{

				//ubico la respuesta correspondiente a la pregunta, si existiera
				while(_misRespDadasTmp.hasMoreElements()){
					miRespDada = (Respuesta)_misRespDadasTmp.nextElement();
					if(miPreg.getId() == miRespDada.getInstanciaPregunta().getId()){
						respEncontrada = true;
						break;
					}
				}

				_pregResp.append("<input type='text' name='pregunta_"+miPreg.getId()+"' id='pregunta_"+miPreg.getId()+"'");

				if(miPreg.isCampo_clave_unico()){
					_pregResp.append(" readonly ");
				}
				//+++++++++++++++
				//pregunta abierta para texto
				//+++++++++++++++
				if(miPreg.getTipoPregunta() == 30){
					if(!respEncontrada || miRespDada.getRespuestaAbiertaTexto().equals("")){
						//si no encontr\u00c3\u00a9 respuesta
						_pregResp.append(" value=''>");
					}else{
						//si encontr\u00c3\u00a9 respuesta
						_pregResp.append(" value='"+miRespDada.getRespuestaAbiertaTexto()+"'>");
					}

				//+++++++++++++++
				//pregunta abierta para numeros sin decimales
				//+++++++++++++++
				}else if(miPreg.getTipoPregunta() == 31){
					if(!respEncontrada || (miRespDada.getRespuestaAbiertaInt() == 0)){
						//si no encontr\u00c3\u00a9 respuesta
						_pregResp.append(" value='0' onblur='validarEntero(\"pregunta_"+miPreg.getId()+"\");'>");
					}else{
						//si encontr\u00c3\u00a9 respuesta
						_pregResp.append(" value='"+String.valueOf(miRespDada.getRespuestaAbiertaInt())+"' onblur='validarEntero(\"pregunta_"+miPreg.getId()+"\");'>");
					}

				//+++++++++++++++
				//pregunta abierta para numeros con decimales
				//+++++++++++++++
				}else if(miPreg.getTipoPregunta() == 32){
					DecimalFormat _df = new DecimalFormat("###############.############");
					if(!respEncontrada || miRespDada.getRespuestaAbiertaDouble() == 0F){
						//si no encontr\u00c3\u00a9 respuesta
						_pregResp.append(" value='0.0' onblur='validarDouble(\"pregunta_"+miPreg.getId()+"\");'>");
					}else{
						//si encontr\u00c3\u00a9 respuesta
						_pregResp.append(" value='"+_df.format(miRespDada.getRespuestaAbiertaDouble())+"' onblur='validarDouble(\"pregunta_"+miPreg.getId()+"\");'>");
					}

				//+++++++++++++++
				//pregunta abierta para fechas
				//+++++++++++++++
				}else if(miPreg.getTipoPregunta() == 33){
					if(!respEncontrada || miRespDada.getRespuestaAbiertaDate() == null){
						//si no encontr\u00c3\u00a9 respuesta
						_pregResp.append(" value='' ");
					}else{
						//si encontr\u00c3\u00a9 respuesta
						String[] _respDate = miRespDada.getRespuestaAbiertaDate().toString().split("-");
						_pregResp.append(" value='"+_respDate[2]+"-"+_respDate[1]+"-"+_respDate[0]+"' ");
					}
					_pregResp.append(" readonly onclick='if(self.gfPop)gfPop.fPopCalendar(document.getElementById(\"pregunta_"+miPreg.getId()+"\"));return false;'>");
				}
			}
		}

		out.println(_pregTit);
		out.println(_pregResp);
		
      out.write(_jsp_string7, 0, _jsp_string7.length);
      
	}catch(Exception e){e.printStackTrace();}
}

      out.write(_jsp_string8, 0, _jsp_string8.length);
    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      com.caucho.jsp.QJspFactory.freePageContext(pageContext);
    }
  }

  private java.util.ArrayList _caucho_depends = new java.util.ArrayList();

  public java.util.ArrayList _caucho_getDependList()
  {
    return _caucho_depends;
  }

  public void _caucho_addDepend(com.caucho.make.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;
    if (com.caucho.util.CauchoSystem.getVersionId() != -4644494061398360982L)
      return true;
    for (int i = _caucho_depends.size() - 1; i >= 0; i--) {
      com.caucho.make.Dependency depend;
      depend = (com.caucho.make.Dependency) _caucho_depends.get(i);
      if (depend.isModified())
        return true;
    }
    return false;
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("WEB-INF/vistas/userobjetos.jsp"), -3443778122896330318L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("WEB-INF/vistas/userinicio.jsp"), -1421569813041706404L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("WEB-INF/vistas/userheader.jsp"), -2231565818208207886L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("WEB-INF/vistas/adminfooter.jsp"), 8445709753414532245L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  private final static char []_jsp_string4;
  private final static char []_jsp_string0;
  private final static char []_jsp_string8;
  private final static char []_jsp_string3;
  private final static char []_jsp_string6;
  private final static char []_jsp_string7;
  private final static char []_jsp_string5;
  private final static char []_jsp_string2;
  private final static char []_jsp_string1;
  static {
    _jsp_string4 = "\nNo existen en este momento Censos o Encuestas disponibles.\n".toCharArray();
    _jsp_string0 = "\n\n\n\n\n".toCharArray();
    _jsp_string8 = "\n</td></tr></table>\n				  </center>\r\n				</td>\r\n			</tr>\r\n		</table>\r\n		</center>\r\n		<div class=\"encapsulador\" id=\"id_encapsulador\" onclick=\"$('#id_encapsulador').hide('slow')\">\r\n			<div class=\"fondo\">\r\n				<div class=\"mensaje_alerta\">\r\n					<p><img src=\"comunes/imagenes/loading2.gif\" title=\"Cargando... por favor, espere un momento.\">&nbsp;Cargando... por favor, espere un momento.</p>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</body>\r\n	<script type=\"text/javascript\" src=\"comunes/javascript/jquery.qtip.js\"></script>\r\n	<script type=\"text/javascript\">\r\n		$('img[title]').qtip({\r\n			style: {\r\n				name: 'green',\r\n				tip: true,\r\n				color: 'black'\r\n			},\r\n			border: {\r\n				 width: 7,\r\n				 radius: 5,\r\n				 color: '#A2D959'\r\n			},\r\n			hide:{ when: { event: 'mouseout'}},\r\n			position: {\r\n				corner: {\r\n				 target: 'topMiddle',\r\n				 tooltip: 'bottomMiddle'\r\n				}\r\n			 }\r\n		});\r\n		$('a[title]').qtip({\r\n			style: {\r\n				name: 'green',\r\n				tip: true,\r\n				color: 'black'\r\n			},\r\n			border: {\r\n				 width: 7,\r\n				 radius: 5,\r\n				 color: '#A2D959'\r\n			},\r\n			hide:{ when: { event: 'mouseout'}},\r\n			position: {\r\n				corner: {\r\n				 target: 'topMiddle',\r\n				 tooltip: 'bottomMiddle'\r\n				}\r\n			 }\r\n		});\r\n	</script>\r\n</html>\r\n\n".toCharArray();
    _jsp_string3 = "\n<table cellpadding=\"4\" cellspacing=\"4\" class=\"tablasecundariatitulo\">\n	<tr>\n		<td style=\"text-align:left\" valign=\"top\">\n			<h2>Responda las preguntas que se indican</h2>\n		</td>\n		<td style=\"text-align:right\" valign=\"bottom\" width=\"36px\">\n			<a href=\"autenticarusuario.do\" ><img src=\"comunes/imagenes/back.png\" title=\"Regresar a la Secci&oacute;n Anterior\" alt=\"Regresar a la Secci&oacute;n Anterior\" ></a>\n		</td>\n	</tr>\n</table>\n\n<table class=\"tablasecundaria\" cellpadding=\"4\" cellspacing=\"4\">\n	<tr>\n		<td>\n".toCharArray();
    _jsp_string6 = "\">\n		<input type=\"hidden\" name=\"accionaejecutar\" id=\"accionaejecutar\" value=\"insertar\">\n	".toCharArray();
    _jsp_string7 = "\n		<p />\n		<input type='submit' value='Finalizar' onclick=\"alert('Gracias por su participacion.');return true;\">\n		</form>\n		<iframe name='gToday:contrast:agenda.js' id='gToday:contrast:agenda.js' src='Contrast/ipopeng.htm' style='visibility: visible; z-index: 999; position: absolute; top: -500px; left: -500px;' scrolling='no' frameborder='0' height='142' width='132'>\n		</iframe>\n		".toCharArray();
    _jsp_string5 = "\n	<form action=\"userobjetos.do\" method=\"post\" name=\"miformulario2\" id=\"miformulario2\">\n		<input type=\"hidden\" name=\"id_instrumento\" id=\"id_instrumento\" value=\"".toCharArray();
    _jsp_string2 = "\n<html>\n	<head>\n		<META http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n		<title>SIGECENE - Sistema Para La Gesti\u00f3n De Censos, Encuestas y Estudios</title>\n		<link type=\"image/x-icon\" href=\"comunes/imagenes/favicon.ico\" rel=\"icon\" />\n		<link type=\"image/x-icon\" href=\"comunes/imagenes/favicon.ico\" rel=\"shortcut icon\" />\n		<link rel=\"stylesheet\" type=\"text/css\" href=\"comunes/css/micss.css\">\n		<!-- IE 6 \"fixes\" -->\n		<!--[if lt IE 7]>\n		<link type='text/css' href='comunes/css/basic_ie.css' rel='stylesheet' media='screen' />\n		<![endif]-->\n		<script type=\"text/javascript\" src=\"comunes/javascript/jquery.js\"></script>\n		<script type=\"text/javascript\" src=\"comunes/javascript/jquery.simplemodal.js\"></script>\n	</head>\n\n\n\n<script type=\"text/javascript\" charset=\"UTF-8\">\nif (/msie/i.test (navigator.userAgent)) //only override IE\n{\n	document.nativeGetElementById = document.getElementById;\n	document.getElementById = function(id)\n	{\n		var elem = document.nativeGetElementById(id);\n		if(elem)\n		{\n			//make sure that it is a valid match on id\n			if(elem.attributes['id'].value == id)\n			{\n				return elem;\n			}\n			else\n			{\n				//otherwise find the correct element\n				for(var i=1;i<document.all[id].length;i++)\n				{\n					if(document.all[id][i].attributes['id'].value == id)\n					{\n						return document.all[id][i];\n					}\n				}\n			}\n		}\n		return null;\n	};\n}\n\nfunction validarEntero(_nombreElem){\n	var mielem = document.getElementById(_nombreElem);\n  var er = /^[-]*[0-9]+$/;\n	if(mielem){\n		if(mielem.value.match(er)){\n			return true;\n		}else{\n			alert(\"Solo pueden ingresarse numeros enteros.\");\n			mielem.value = \"0\";\n			mielem.focus();\n			return false;\n		}\n	}\n	return false;\n}\n\nfunction validarDouble(_nombreElem){\n	var mielem = document.getElementById(_nombreElem);\n  var er = /^[-+]?[0-9]+(\\.[0-9]+)?$/;\n	if(mielem){\n		if(mielem.value.match(er)){\n			return true;\n		}else{\n			alert(\"Solo pueden ingresarse numeros con o sin decimales.\");\n			mielem.value = \"0.0\";\n			mielem.focus();\n			return false;\n		}\n	}else{\n		return false;\n	}\n}\n</script>\n\n<body>\n	<center>\n	<table cellpadding=\"0\" cellspacing=\"0\" class=\"tablaprincipal\">\n		<tr>\n			<td valign=\"middle\" align=\"left\" style=\"border-top: burlywood ridge thick;border-left: burlywood ridge thick;border-width:3px;max-width:320px;width:320px\">\n				<a href=\"autenticarusuario.do\"><img src=\"comunes/imagenes/siagcee_logo.png\" alt=\"\"></a>\n			</td>\n		</tr>\n		<tr>\n			<td valign=\"top\" align=\"center\">\n				<center>\n			\n".toCharArray();
    _jsp_string1 = "\n	".toCharArray();
  }
}
