/*
 * JSP generated by Resin-3.0.28 (built Mon, 18 May 2009 02:16:38 PDT)
 */

package _jsp._web_22dinf._vistas;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import java.sql.ResultSet;
import java.sql.Connection;
import java.text.SimpleDateFormat;
import java.util.Collections;
import java.util.Enumeration;
import java.util.Vector;
import com.siagcee.logic.*;

public class _sqlpreview__jsp extends com.caucho.jsp.JavaPage{
  private boolean _caucho_isDead;
  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.Application _jsp_application = _caucho_getApplication();
    javax.servlet.ServletContext application = _jsp_application;
    com.caucho.jsp.PageContextImpl pageContext = com.caucho.jsp.QJspFactory.allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    response.setContentType("text/html;charset=UTF-8");
    request.setCharacterEncoding("UTF-8");
    try {
      out.write(_jsp_string0, 0, _jsp_string0.length);
      
HttpSession sesion = request.getSession();
Administrador admin = (Administrador)sesion.getAttribute("administrador");
if(admin == null){

      out.write(_jsp_string1, 0, _jsp_string1.length);
      pageContext.forward("autenticar.do");
      if (true) return;
      out.write('\n');
      
}

      out.write(_jsp_string2, 0, _jsp_string2.length);
      

InstanciaObjeto _miObj = (InstanciaObjeto)sesion.getAttribute("generadorSql_instanciaObjeto");

InstanciaObjeto _objetoatrabajar = null;
Vector _listadoPreguntas = new Vector();
if(request.getAttribute("objetoatrabajar")!=null){
	_objetoatrabajar = (InstanciaObjeto)request.getAttribute("objetoatrabajar");
	_listadoPreguntas = (Vector)_objetoatrabajar.getObjetoAsociado().getPreguntas();
	Collections.sort(_listadoPreguntas, new OrdenadorInstanciaPreguntas());
}

String _sqlFinal = "";
if(request.getAttribute("generadorSql_sqlFinal")!=null){
	_sqlFinal = (String)request.getAttribute("generadorSql_sqlFinal");
}

Vector _respuestas = new Vector();
if(request.getAttribute("respuestas") != null){
	_respuestas = (Vector)request.getAttribute("respuestas");
}

Vector _preguntas = new Vector();
if(request.getAttribute("preguntas") != null){
	_preguntas = (Vector)request.getAttribute("preguntas");
}

String _accioninvitar = "true";
if(request.getParameter("accioninvitar") != null){
	_accioninvitar = (String)request.getParameter("accioninvitar");
}

	
      out.write(_jsp_string3, 0, _jsp_string3.length);
      
	if(_respuestas.isEmpty()){
		out.println("La consulta no arroj&oacute; resultados.<br /><p /><a href='#' onclick='window.close();'>Cerrar esta ventana y regresar.</a>");
	}else{

      out.write(_jsp_string4, 0, _jsp_string4.length);
       out.print(_sqlFinal); 
      out.write(_jsp_string5, 0, _jsp_string5.length);
       out.print(_objetoatrabajar.getId()); 
      out.write(_jsp_string6, 0, _jsp_string6.length);
       out.print(_accioninvitar); 
      out.write(_jsp_string7, 0, _jsp_string7.length);
      
				Enumeration _enu = _listadoPreguntas.elements();
				InstanciaPregunta _pregAct = null;
				while(_enu.hasMoreElements()){
					_pregAct = (InstanciaPregunta)_enu.nextElement();
					out.print("<option value='"+_pregAct.getId()+"'>"+_pregAct.getAcronimo()+"</option>");
				}
			
      out.write(_jsp_string8, 0, _jsp_string8.length);
      
	if(!_preguntas.isEmpty()){

      out.write(_jsp_string9, 0, _jsp_string9.length);
      
			_enu = _preguntas.elements();
			_pregAct = null;
			while(_enu.hasMoreElements()){
				_pregAct = (InstanciaPregunta)_enu.nextElement();
				out.print("<th title='clic aqu&iacute; para ordenar por: "+_pregAct.getTextoPregunta()+"' style='max-width:140px;'>"+_pregAct.getTextoPregunta()+"</th>");
			}
		
      out.write(_jsp_string10, 0, _jsp_string10.length);
      
			_enu = _respuestas.elements();
			Respuesta _respAct = null;
			int id_usuario = -1; 
			while(_enu.hasMoreElements()){
				//para cada usuario
				_respAct = (Respuesta)_enu.nextElement();
				//caso base... partimos de ningun usuario
				if(id_usuario != _respAct.getElaborado_por()){
					//otro usuario
					id_usuario = _respAct.getElaborado_por();
					if(id_usuario != -1){out.println("</tr><tr>");}
				}else{
					//mismo usuario que el anterior... ya procesado
					continue;
				}
				//para cada pregunta busco su correspondiente respuesta
				Enumeration _enu2 = _preguntas.elements();
				_pregAct = null;

				while(_enu2.hasMoreElements()){
					//para cada pregunta
					_pregAct = (InstanciaPregunta)_enu2.nextElement();
					Enumeration _enuInterno = _respuestas.elements();
					Respuesta _respActInterna = null;
					boolean _respEncon = false;
					while(_enuInterno.hasMoreElements()){
						//para cada respuesta donde cuadre usuario y pregunta
						_respActInterna = (Respuesta)_enuInterno.nextElement();
						if((_respActInterna.getElaborado_por() == id_usuario) && (_respActInterna.getInstanciaPregunta().getId() == _pregAct.getId())){
							_respEncon = true;
							try{
								if(_pregAct.getTipoPregunta() < 30){
									out.print("<td>"+_respActInterna.getRespuestaCerrada().getRespuesta()+"</td>");
								}else	if(_pregAct.getTipoPregunta() == 30){
									out.print("<td>"+_respActInterna.getRespuestaAbiertaTexto()+"</td>");
								}else	if(_pregAct.getTipoPregunta() == 31){
									out.print("<td>"+_respActInterna.getRespuestaAbiertaInt()+"</td>");
								}else	if(_pregAct.getTipoPregunta() == 32){
									out.print("<td>"+_respActInterna.getRespuestaAbiertaDouble()+"</td>");
								}else	if(_pregAct.getTipoPregunta() == 33){
									String[] _respDate = _respActInterna.getRespuestaAbiertaDate().toString().split("-");
									out.print("<td>"+_respDate[2]+"-"+_respDate[1]+"-"+_respDate[0]+"</td>");
								}
							}catch (Exception e1){out.print("<td>Error cargando esta respuesta</td>");}
							break;
						}
					}
					if(!_respEncon){
						out.print("<td>No Sabe / No Responde</td>");
					}
				}
			}
		
      out.write(_jsp_string11, 0, _jsp_string11.length);
       if(_accioninvitar.equals("true")) {
      out.write(_jsp_string12, 0, _jsp_string12.length);
      
			_enu = _listadoPreguntas.elements();
			_pregAct = null;
			while(_enu.hasMoreElements()){
				_pregAct = (InstanciaPregunta)_enu.nextElement();
				if(_pregAct.isCampo_comunicacion_email()){
					out.print("<option value='"+_pregAct.getId()+"' selected='selected'>"+_pregAct.getAcronimo()+"</option>");
				}else{
					out.print("<option value='"+_pregAct.getId()+"'>"+_pregAct.getAcronimo()+"</option>");
				}
			}
			SimpleDateFormat _dateFormat = new SimpleDateFormat("dd/MM/yyyy");
			
      out.write(_jsp_string13, 0, _jsp_string13.length);
       if(_miObj != null){ 
      out.write(_jsp_string14, 0, _jsp_string14.length);
       if(_miObj.getObjetoAsociado().getClass().toString().contains("Censo")){out.print("el censo: ");}else{out.print("la encuesta: ");} out.print(_miObj.getObjeto());
      out.write(_jsp_string15, 0, _jsp_string15.length);
       out.print(_dateFormat.format(_miObj.getFechaInicio()));
      out.write(_jsp_string16, 0, _jsp_string16.length);
       out.print(_dateFormat.format(_miObj.getFechaCierre()));
      out.write(_jsp_string17, 0, _jsp_string17.length);
       }else{ 
      out.write(_jsp_string18, 0, _jsp_string18.length);
       } 
      out.write(_jsp_string19, 0, _jsp_string19.length);
       }else{ 
      out.write(_jsp_string20, 0, _jsp_string20.length);
       } 
      out.write(_jsp_string21, 0, _jsp_string21.length);
      
		}
	}

      out.write(_jsp_string22, 0, _jsp_string22.length);
    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      com.caucho.jsp.QJspFactory.freePageContext(pageContext);
    }
  }

  private java.util.ArrayList _caucho_depends = new java.util.ArrayList();

  public java.util.ArrayList _caucho_getDependList()
  {
    return _caucho_depends;
  }

  public void _caucho_addDepend(com.caucho.make.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;
    if (com.caucho.util.CauchoSystem.getVersionId() != -4644494061398360982L)
      return true;
    for (int i = _caucho_depends.size() - 1; i >= 0; i--) {
      com.caucho.make.Dependency depend;
      depend = (com.caucho.make.Dependency) _caucho_depends.get(i);
      if (depend.isModified())
        return true;
    }
    return false;
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("WEB-INF/vistas/sqlpreview.jsp"), -3064183081228946937L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("WEB-INF/vistas/admininicio.jsp"), -2698818426022610974L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("WEB-INF/vistas/adminfooter.jsp"), 8445709753414532245L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  private final static char []_jsp_string10;
  private final static char []_jsp_string14;
  private final static char []_jsp_string7;
  private final static char []_jsp_string1;
  private final static char []_jsp_string2;
  private final static char []_jsp_string3;
  private final static char []_jsp_string9;
  private final static char []_jsp_string18;
  private final static char []_jsp_string21;
  private final static char []_jsp_string13;
  private final static char []_jsp_string19;
  private final static char []_jsp_string8;
  private final static char []_jsp_string11;
  private final static char []_jsp_string22;
  private final static char []_jsp_string5;
  private final static char []_jsp_string15;
  private final static char []_jsp_string0;
  private final static char []_jsp_string6;
  private final static char []_jsp_string20;
  private final static char []_jsp_string16;
  private final static char []_jsp_string17;
  private final static char []_jsp_string4;
  private final static char []_jsp_string12;
  static {
    _jsp_string10 = "\n	</tr>\n	</thead>\n	<tbody>\n	<tr>\n		".toCharArray();
    _jsp_string14 = "\n		<label>Mensaje a ser colocado en el correo a enviar:</label><br />\n		<textarea rows=\"10\" cols=\"120\" id=\"email_id_invite_text\" name=\"email_id_invite_text\">\n			Se le invita cordialmente a participar en ".toCharArray();
    _jsp_string7 = "\" id=\"accioninvitar\" name=\"accioninvitar\">\n		<label>Indique que preguntas desea revisar:</label><br />\n		<select multiple=\"multiple\" id=\"preguntasdeseadas\" name=\"preguntasdeseadas\" size=\"8\">\n			".toCharArray();
    _jsp_string1 = "\n	".toCharArray();
    _jsp_string2 = "\n<html>\n	<head>\n		<META http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n		<title>SIGECENE - Sistema Para La Gesti\u00f3n De Censos, Encuestas y Estudios</title>\n    <link type=\"image/x-icon\" href=\"comunes/imagenes/favicon.ico\" rel=\"icon\" />\n    <link type=\"image/x-icon\" href=\"comunes/imagenes/favicon.ico\" rel=\"shortcut icon\" />\n		<link rel=\"stylesheet\" type=\"text/css\" href=\"comunes/css/micss.css\">\n		\n		<!-- IE 6 \"fixes\" -->\n		<!--[if lt IE 7]>\n		<link type='text/css' href='comunes/css/basic_ie.css' rel='stylesheet' media='screen' />\n		<![endif]-->\n		<script type=\"text/javascript\" src=\"comunes/javascript/jquery.js\"></script>\n		<script type=\"text/javascript\" src=\"comunes/javascript/jquery.simplemodal.js\"></script>\n		<script type=\"text/javascript\" src=\"comunes/javascript/jquery.tablesorter.min.js\"></script>\n		<script type=\"text/javascript\" src=\"comunes/javascript/espanol.js\"></script>\n		<script type=\"text/javascript\" src=\"comunes/javascript/whizzywig61.js\"></script>\n	</head>\n\n\n<script type=\"text/javascript\">\n	$(document).ready(function(){\n		//whizzywig();\n	});\n</script>\n<body>\n	<table cellpadding=\"0\" cellspacing=\"0\" class=\"tablaprincipal\">\n		<tr>\n			<td valign=\"middle\" align=\"left\" style=\"border-top: burlywood ridge thick;border-left: burlywood ridge thick;border-width:3px;max-width:320px;width:320px\">\n				<img src=\"comunes/imagenes/siagcee_logo.png\" alt=\"\">\n			</td>\n		</tr>\n		<tr>\n			<td valign=\"top\" align=\"left\">\n				<table cellpadding=\"4\" cellspacing=\"4\" class=\"tablasecundariatitulo\" style=\"width:950px;min-width:950px;max-width:950px;\">\n					<tr>\n						<td style=\"text-align:left\" valign=\"top\" >\n							<h2>Informaci&oacute;n</h2>\n						</td>\n					</tr>\n				</table>\n\n\n".toCharArray();
    _jsp_string3 = "\n<table class=\"tablasecundaria\" cellpadding=\"4\" cellspacing=\"4\">\n	<tr>\n		<td>\n	<h3>Vista Preliminar de Encuestados Seleccionados.</h3>\n".toCharArray();
    _jsp_string9 = "\n	<table id=\"myTable\" class=\"tablesorter\" style=\"min-width:940px;max-width:940px;width:940px\">\n	<thead>\n	<tr>\n		".toCharArray();
    _jsp_string18 = "\n			 <input type=\"hidden\" value=\"\" id=\"email_id_invite_text\" name=\"email_id_invite_text\">\n		".toCharArray();
    _jsp_string21 = "\n	<br />\n</td></tr></table>			\n\n<script type=\"text/javascript\">\n	$(document).ready(function(){\n		$(\"#myTable\").tablesorter();\n	 });\n</script>\n\n".toCharArray();
    _jsp_string13 = "\n		</select><p />\n		".toCharArray();
    _jsp_string19 = "\n		<button value=\"Procesar estos usuarios\" onclick=\"window.opener.document.getElementById('id_encapsulador').style.display = 'block';window.opener.document.getElementById('hacerpreview').value='falso';window.opener.document.getElementById('email_id_invite').value=document.getElementById('email_id_invite').value;window.opener.document.getElementById('email_id_invite_text').value=document.getElementById('email_id_invite_text').value;window.opener.document.getElementById('formgenerasql').target = '_top';window.opener.document.getElementById('formgenerasql').submit();window.close();\">Aceptar y procesar estos usuarios</button>\n		<button value=\"Cerrar esta ventana\" onclick=\"window.close();\">Cancelar y cerrar esta ventana</button>\n	</form>		\n	".toCharArray();
    _jsp_string8 = "\n		</select><br />\n		<input type=\"submit\" value=\"Revisar\" onclick=\"if($('#preguntasdeseadas').attr('value') == ''){alert('Debe indicar las preguntas que desea revisar');return false;}return true;\">\n	</form>\n".toCharArray();
    _jsp_string11 = "\n	</tr>\n	</tbody>\n	</table>\n	".toCharArray();
    _jsp_string22 = "\n\n				  </center>\r\n				</td>\r\n			</tr>\r\n		</table>\r\n		</center>\r\n		<div class=\"encapsulador\" id=\"id_encapsulador\" onclick=\"$('#id_encapsulador').hide('slow')\">\r\n			<div class=\"fondo\">\r\n				<div class=\"mensaje_alerta\">\r\n					<p><img src=\"comunes/imagenes/loading2.gif\" title=\"Cargando... por favor, espere un momento.\">&nbsp;Cargando... por favor, espere un momento.</p>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</body>\r\n	<script type=\"text/javascript\" src=\"comunes/javascript/jquery.qtip.js\"></script>\r\n	<script type=\"text/javascript\">\r\n		$('img[title]').qtip({\r\n			style: {\r\n				name: 'green',\r\n				tip: true,\r\n				color: 'black'\r\n			},\r\n			border: {\r\n				 width: 7,\r\n				 radius: 5,\r\n				 color: '#A2D959'\r\n			},\r\n			hide:{ when: { event: 'mouseout'}},\r\n			position: {\r\n				corner: {\r\n				 target: 'topMiddle',\r\n				 tooltip: 'bottomMiddle'\r\n				}\r\n			 }\r\n		});\r\n		$('a[title]').qtip({\r\n			style: {\r\n				name: 'green',\r\n				tip: true,\r\n				color: 'black'\r\n			},\r\n			border: {\r\n				 width: 7,\r\n				 radius: 5,\r\n				 color: '#A2D959'\r\n			},\r\n			hide:{ when: { event: 'mouseout'}},\r\n			position: {\r\n				corner: {\r\n				 target: 'topMiddle',\r\n				 tooltip: 'bottomMiddle'\r\n				}\r\n			 }\r\n		});\r\n	</script>\r\n</html>\r\n".toCharArray();
    _jsp_string5 = "\" id=\"generadorSql_sqlFinal\" name=\"generadorSql_sqlFinal\">\n		<input type=\"hidden\" value=\"".toCharArray();
    _jsp_string15 = ".<br />\n			Iniciando el: ".toCharArray();
    _jsp_string0 = "\n\n\n\n\n\n\n\n<!--\n * Creado por F\u00e1bio Pereira.\n * Bajo la tutor\u00eda del Prof. Francisco Mirabal.\n * Trabajo Especial De Grado.\n * Licenciatura de Computaci\u00f3n.\n * Universidad Central de Venezuela.\n * Fecha: 10/12/2009\n * Hora: 09:07:17 AM\n-->\n".toCharArray();
    _jsp_string6 = "\" id=\"objetoatrabajar\" name=\"objetoatrabajar\">\n		<input type=\"hidden\" value=\"".toCharArray();
    _jsp_string20 = "\n	<button value=\"Cerrar esta ventana\" onclick=\"window.close();\">Cerrar esta ventana</button>\n	".toCharArray();
    _jsp_string16 = " y finaliza el: ".toCharArray();
    _jsp_string17 = "<br />\n		</textarea>\n		<script language=\"JavaScript\" type=\"text/javascript\">\n	    makeWhizzyWig(\"email_id_invite_text\");\n		</script><p />\n		".toCharArray();
    _jsp_string4 = "\n	<form action=\"sqlpreview\" method=\"post\" target=\"_top\">\n		<input type=\"hidden\" value=\"".toCharArray();
    _jsp_string12 = "\n	<form action=\"#\">\n		<label>Indique cu&aacute;l es el campo de correo electr&oacute;nico a utilizar para invitar a los participantes:</label><br />\n		<select id='email_id_invite' name=\"email_id_invite\">\n			".toCharArray();
  }
}
